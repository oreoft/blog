# 状态机复制的共识算法



## ZAB



## Raft

#### 领导选举

1. 每个结点会有一个timeout的到期时间，一旦到期这个结点就会认为自己的leader，就会给其他结点发送心跳，其他结点收到心跳以后知道这个结点是leader结点。
2. 如果同时有两个到期结点发到心跳给对方，双方认为自己是leader结点然后收到了别人的心跳，这两个会重新一轮timeout，因为这两个leader都是继续等待timeout，另外结点没收到心跳会有一个提前到期，然后主动发送心跳给其他的结点，最终竞选出leader



#### 日志复制

1. 客户端给leader提交消息
2. leader并不会第一时间把消息持久化(因为raft也是基于cp)
3. leader第一时间会在下一次心跳里通知所有的follow，leader会等待所有的follow的响应
4. 如果有半数follow响应(注意follow只是响应，还没有写入)，leader会把自己的值进行更新，给客户端发送成功ack消息，然后再正式向follow发起写入通知
5. 期间如果是有半数没有响应则leader会放弃这个消息

#### 安全性



#### 成员变更



