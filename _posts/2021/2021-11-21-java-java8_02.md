---
layout: post
title: java8å‡½æ•°å¼ç¼–ç¨‹-ä¸‹
excerpt: å®‰åˆ©ä¸€ä¸‹æœ€è¿‘å‘ç°çš„å‡½æ•°å¼åº“vavr
category: java
keywords: java
---

## å‰è¨€

[ä¸Šç¯‡](https://www.someget.cn/java/2021/11/05/java-java8_01.html)ç®€å•æ€»ç»“äº†å‡½æ•°å¼æ¥å£ï¼Œè¿™ç¯‡ç»™å¤§å®¶ä»‹ç»æœ€è¿‘è®©æˆ‘ä¸ºä¹‹ç€è¿·çš„**javaå‡½æ•°ç¼–ç¨‹åº“-vavr**.æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼Œå‡½æ•°å¼æ¥å£æ˜¯vavrçš„åŸºç¡€ï¼Œæ‰€ä»¥vavræœ€ä½æ”¯æŒçš„ç‰ˆæœ¬æ˜¯java8ã€‚ä½¿ç”¨vavrå¯ä»¥æœ‰æ•ˆå‡å°‘ä»£ç é‡å¹¶ä¸”æå‡ä»£ç çš„ä¼˜é›…ç¨‹åº¦ã€‚ä¸€æ–¹é¢å¯ä»¥å¼¥è¡¥java8è‡ªå¸¦å‡½æ•°å¼APIçš„ä¸å®Œå¤‡å’Œå‹å¥½ï¼Œå¦å¤–ä¸€æ–¹é¢å¯ä»¥èŠ‚çœä½ è‡ªå·±é€ è½®å­çš„å·¥ä½œã€‚

åˆé—»vavrï¼Œæ„Ÿè§‰å¾ˆå¥‡æ€ªï¼Œå’‹è¿™ä¸ªåå­—ï¼Œåé¢çœ‹åˆ°å®ƒçš„[å®˜ç½‘](https://www.vavr.io/)æˆ‘æ²‰é»˜äº†ï¼Œæ€€ç–‘åˆåˆ›å›¢é˜Ÿä»˜è´¹èµ„è®¯äº†UCéœ‡æƒŠéƒ¨å¦‚ä½•å–åå­—ï¼Œå¥½å®¶ä¼™ï¼Œvavrå°±æ˜¯javaè¿™å››ä¸ªå­—å€’è¿‡æ¥ï¼ŒçœŸçš„æ˜¯'é¢ è¦†äº†'java.....

![](https://mypicgogo.oss-cn-hangzhou.aliyuncs.com/tuchuang20211121131800.png)

<center>å®˜ç½‘æˆªå›¾</center> 

![image-20211121134906921](https://mypicgogo.oss-cn-hangzhou.aliyuncs.com/tuchuang20211121134906.png)

<center>å®˜ç½‘æˆªå›¾å€’ç½®å¤„ç†å</center>

æ¥ä¸‹æ¥æˆ‘ä¼šä»‹ç»vavrçš„ä¸€äº›ç®€å•ç‰¹æ€§ï¼Œä¸ºäº†é¿å…æˆä¸ºå®˜æ–¹æ–‡æ¡£çš„ç¿»è¯‘ï¼Œæˆ‘ä¼šæç‚¼ä¸€ä¸‹åŠ ä¸€äº›demoï¼Œä¸ä¼šæ·±å…¥æºç ç»†èŠ‚ï¼Œé‡åœ¨ä½¿ç”¨ã€‚**å¦‚æœçœ‹åˆ°ç°åœ¨ä½ è¿˜ä¸çŸ¥é“vavræœ‰å•¥ç”¨ï¼Œè¿™é‡Œå…ˆç®€å•è¯´ä¸€ä¸‹è¿™ä¸ªåº“æˆ‘è§‰å¾—ä¸‰ä¸ªé‡è¦çš„â€˜é¢ è¦†â€™ï¼š**

1. vavræä¾›é€šè¿‡å¢å¼ºå‡½æ•°æ¥å£(æä¾›æ¯”jdkè‡ªå¸¦æ›´åŠ å¼ºå¤§ä¾¿åˆ©çš„æ¥å£)ã€‚
2. æä¾›ä¼—å¤šä¾èµ–å‡½æ•°å¼æ¥å£çš„ç‰¹æ€§(æ–¹æ³•)ã€‚
3. æä¾›æ¥è¿‘äºscalaçš„é›†åˆåº“(ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹ç‰¹æ€§çš„ä¸å¯å˜é›†åˆ)ã€‚

**å¦å¤–æœ¬ç¯‡æ–‡ç« çš„ä»£ç å·²ç»ä¸Šä¼ è‡³[Github](https://github.com/oreoft/blog-examples/tree/main/java8-vavr)**

## mavenå¯¼å…¥

vavrä¸€ç›´åœ¨æ›´æ–°ï¼Œä½†æ˜¯1.0å§‹ç»ˆæ²¡å‘å¸ƒï¼Œç°åœ¨ä¸»åˆ†æ”¯è¿˜æ˜¯åœ¨0.10.xã€‚æˆªæ­¢å‘æ–‡å‰æœ€æ–°ç‰ˆæ˜¯`0.10.4`ï¼Œå¦‚æœè¿½æ±‚æœ€æ–°ç‰ˆï¼Œå¯ä»¥å»è¿™[æŸ¥è¯¢](https://mvnrepository.com/artifact/io.vavr/vavr)ã€‚

```xml
<dependency>
    <groupId>io.vavr</groupId>
    <artifactId>vavr</artifactId>
    <version>0.10.4</version>
</dependency>
```

vavræ²¡æœ‰ä½¿ç”¨ä¸‰æ–¹ä¾èµ–ï¼Œæ‰€æœ‰ä»£ç éƒ½æ˜¯è‡ªå·±æ‰‹æ’¸çš„ï¼Œå¯¼è‡´å®ƒçš„ä½“ç§¯ç‰¹åˆ«å°ï¼Œ1mä¸åˆ°

![image-20211121133544886](https://mypicgogo.oss-cn-hangzhou.aliyuncs.com/tuchuang20211121133544.png)

<center>ä»ä¸­å¤®ä»“åº“ä¸‹è½½ä¸‹æ¥</center>

## Functionæ¥å£çš„å¢å¼º

jdkè‡ªå¸¦çš„å‡½æ•°å¼æ¥å£ä¸Šç¯‡ä»‹ç»äº†ï¼Œå…¶å®æ— è®ºæ˜¯éœ€æ±‚è¿˜æ˜¯åŠŸèƒ½éƒ½ç¨ç¨æœ‰ç‚¹å¼±ï¼ŒFunctionè®°å¾—å§ï¼ŒFunctionçš„æŠ½è±¡æ–¹æ³•æ˜¯applyï¼Œå®ƒçš„å‡½æ•°ä½œç”¨æ˜¯ä¼ å…¥ä¸€ä¸ªç±»å‹è½¬æ¢æˆå¦å¤–ä¸€ä¸ªç±»å‹ã€‚é‚£å¦‚æœæˆ‘æƒ³è¦ä¼ å…¥ä¸¤ä¸ªä¸åŒç±»å‹è½¬æˆç¬¬ä¸‰ç§ç±»å‹å‘¢ï¼Œå¦‚æœçœ‹è¿‡`java.util.function`åŒ…ä»¥åä½ è‚¯å®šä¼šè¯´æœ‰BiFunctionï¼Œé‚£ä¸‰ä¸ªå‘¢ï¼Œå››ä¸ªå‘¢ï¼Œé‚£æ˜¯ä¸æ˜¯è¦è‡ªå·±æ‰©å±•äº†ã€‚

### Fcuntion(0....8)æ¥å£

vavrç»™æˆ‘ä»¬æä¾›äº†èƒ½æ‰©å±•æ›´å¤šçš„å‡½æ•°ï¼Œä¾‹å¦‚Functionç±»ï¼Œå°±æä¾›Function0åˆ° Function8ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šå¯æ¥å—8ä¸ªå‚æ•°çš„å‡½æ•°ã€‚ä¾‹å¦‚ä¸‹é¢å±•ç¤ºçš„ä¸€ä¸ªæ‹¼æ¥:

```java
  @Test
  public void multiFunctionTest() {
    Function4<String, String, Boolean, Integer, String> func =
        (country, name, isMan, score) -> String.format("%s-%s-%s-%d", country, name, isMan ? "ç”·" : "å¥³", score);
    System.out.println(func.apply("ä¸­å›½", "å°æ˜", true, 10));
  }
// ä¸­å›½-å°æ˜-ç”·-10
```

### æ›´å¤šå‡½æ•°å¼ç‰¹æ€§

vavrè¿˜å¯¹å‡½æ•°åšäº†å¢å¼ºï¼Œé™¤äº†jdkä¹Ÿæœ‰çš„andThen()å’Œcompose()ã€‚vavrçš„æ¥å£è¿˜æœ‰å‡½æ•°ç¼–ç¨‹çš„çœŸé—­åŒ…ç‰¹æ€§ï¼Œä¾‹å¦‚ç§‘é‡ŒåŒ–ã€Liftingã€Memoizationç­‰ï¼Œä¸‹é¢ä¸€ä¸€ä»‹ç»

#### Composition

è¿™ä¸ªjdkå…¶å®ä¹Ÿè‡ªå¸¦ï¼Œå…¶å®å°±æ˜¯æ•°å­¦ä¸­çš„å¤åˆå‡½æ•°æ¦‚å¿µï¼Œf(x)çš„yå¯ä»¥æ˜¯g(x)çš„x`g(f(x))`ã€‚

å…¶ä¸­æœ‰ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥å®Œæˆï¼Œä¸€ä¸ªæ˜¯**andThen()**ï¼Œä¸€ä¸ªæ˜¯ä¸ª**compose()**ï¼Œ demoä¸€ä¸‹å°±çŸ¥é“äº†

```java
@Test
public void andThenTest() {
  Function4<String, String, Boolean, Integer, String> func1 =
      (country, name, isMan, score) -> String.format("%s-%s-%s-%d", country, name, isMan ? "ç”·" : "å¥³", score);
  // andThenå°±æ˜¯æŠŠfun1çš„è¿”å›å€¼ç„¶ååœ¨è¿›è¡Œæ¥ä¸‹æ¥çš„func2æ“ä½œ
  Function4<String, String, Boolean, Integer, String> func2 = func1
      .andThen(str -> String.join(":", StrUtil.split(str, '-')));
  System.out.println(func2.apply("ä¸­å›½", "å°æ˜", true, 10));
}
// ä¸­å›½:å°æ˜:ç”·:10
```

äºæ­¤ç±»ä¼¼è¿˜æœ‰composeï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•åªæœ‰Function1æ‰æœ‰ï¼Œæœ¬è´¨å…¶å®å°±æ˜¯æŠŠæ‰§è¡Œé¡ºåºæ¢ä¸€ä¸‹ï¼Œå…¶å®éƒ½æ˜¯åšåˆ°ç±»ä¼¼ç¬¦åˆå‡½æ•°

```java
@Test
public void composeTest() {
  Function1<Long, String> func1 = num -> num + "%";
  // å…ˆæ‰§è¡Œåˆ†composeé‡Œé¢çš„apply, ç„¶åæŠŠç»“æœæ”¾å…¥func1çš„applyä¸­
  Function1<Double, String> func2 = func1.compose((Double num) -> Math.round(num));
  System.out.println(func2.apply(12.25));
}
// 12%
```

#### **PartialApply**

éƒ¨åˆ†åº”ç”¨æ˜¯æŒ‡å‡å¦‚çš„Fcuntionå…¥å‚æœ‰5ä¸ªï¼Œä½ apply()ä¸­ä¼ å…¥äº†2ä¸ªï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯applyä¹Ÿä¸ä¼šæ­£å¸¸æ‰§è¡Œä½ çš„å‡½æ•°ï¼Œè€Œæ˜¯å†ç”Ÿæˆä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å…¥å‚åªæœ‰3ä¸ªï¼Œæ˜¯ç”±åŸæ¥äº”ä¸ªå‚æ•°å…¶ä¸­ä¸¤ä¸ªè¢«å†™å›ºå®šå€¼è½¬æ¢è€Œæ¥çš„ã€‚show code

```java
@Test
public void partialApplyTest() {
  Function4<String, String, Boolean, Integer, String> func1 =
      (country, name, isMan, score) -> String.format("%s-%s-%s-%d", country, name, isMan ? "ç”·" : "å¥³", score);

  Function3<String, Boolean, Integer, String> func2 = func1.apply("ä¸­å›½");
  System.out.println(func2.apply("å°æ˜", true, 10));

  Function2<Boolean, Integer, String> func3 = func1.apply("ä¸­å›½", "å°æ˜");
  System.out.println(func3.apply(true, 10));

  Function1<Integer, String> func4 = func1.apply("ä¸­å›½", "å°æ˜", true);
  System.out.println(func4.apply(10));

  System.out.println(func1.apply("ä¸­å›½", "å°æ˜", true, 10));
}
// ä¸­å›½-å°æ˜-ç”·-10
// ä¸­å›½-å°æ˜-ç”·-10
// ä¸­å›½-å°æ˜-ç”·-10
// ä¸­å›½-å°æ˜-ç”·-10
```



#### ç§‘é‡ŒåŒ–

ç§‘é‡ŒåŒ–æ˜¯æŠŠæ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°å˜æ¢æˆæ¥å—ä¸€ä¸ªå•ä¸€å‚æ•°ï¼ˆæœ€åˆå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰çš„å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›æ¥å—ä½™ä¸‹çš„å‚æ•°è€Œä¸”è¿”å›ç»“æœçš„æ–°å‡½æ•°çš„æŠ€æœ¯ã€‚åªéœ€è¦è°ƒç”¨funcçš„curried()æ–¹æ³•å°±å¯ä»¥æŠŠç§‘é‡ŒåŒ–å‡½æ•°ï¼Œæ¥ä¸‹æ¥ä½ æ¯æ¬¡apply()åªèƒ½ä¼ å…¥ä¸€ä¸ªå€¼ï¼Œä»–çš„è¿”å›å€¼è¿˜æ˜¯ä¸€ä¸ªç§‘é‡ŒåŒ–çš„å‡½æ•°ã€‚å…·ä½“çœ‹ä¸‹é¢ä»£ç ã€‚

```java
@Test
public void curriedTest() {
  Function4<String, String, Boolean, Integer, String> func1 =
      (country, name, isMan, score) -> String.format("%s-%s-%s-%d", country, name, isMan ? "ç”·" : "å¥³", score);

  Function1<String, Function1<Boolean, Function1<Integer, String>>> func2 = func1.curried().apply("ä¸­å›½");
  Function1<Boolean, Function1<Integer, String>> func3 = func2.apply("å°æ˜");
  Function1<Integer, String> func4 = func3.apply(true);
  String result = func4.apply(10);

  System.out.println(result);
}
// ä¸­å›½-å°æ˜-ç”·-10
```

è¿™æ ·ä¸Šé¢ä»»æ„ä¸€ä¸ªå‡½æ•°éƒ½å¯ä»¥è¿›è¡Œæ‰©å±•ï¼Œå¤ç”¨ç‡å¤§å¤§æå‡ï¼Œè°ƒç”¨èµ·æ¥æ–¹ä¾¿ã€‚



#### Memorization

è§åçŸ¥æ„ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªå‡½æ•°çš„ç»“æœå­˜èµ·æ¥ï¼Œä¸‹æ¬¡å†æ¬¡è°ƒç”¨å‡½æ•°ç›´æ¥è¿”å›ç¬¬ä¸€æ¬¡è®¡ç®—çš„ç»“æœã€‚ä½¿ç”¨æ–¹æ³•æ˜¯åªéœ€è¦è°ƒç”¨æ¥å£çš„**memoized()**æ–¹æ³•å³å¯ã€‚

Emmm...å®é™…ä½œç”¨ä¸å¤šï¼Œæˆ‘å¦‚æœè¦æ¼”ç¤ºéƒ½åªèƒ½æ‰¾ä¸ªéšæœºæ•°æ¥æ“ä½œï¼Œæ„Ÿè§‰é¡¹ç›®äº‹ä»¶ä¸­çš„åœºæ™¯ä¸å¤šã€‚

```java
@Test
public void memorizeTest() {
  Function0<Double> hashCache = Function0.of(Math::random).memoized();

  double randomValue1 = hashCache.apply();
  System.out.println(randomValue1);
  double randomValue2 = hashCache.apply();
  System.out.println(randomValue2);

}
// 0.6590067689384973
// 0.6590067689384973
```

## åˆ©ç”¨å‡½æ•°å¼æ¥å£å®Œæˆçš„æ–°ç‰¹æ€§

### æ¨¡å¼åŒ¹é…

å¥½æ¶ˆæ¯å¥½æ¶ˆæ¯ï¼Œjava14å·²ç»æ”¯æŒæ¨¡å¼åŒ¹é…äº†ï¼Œä»€ä¹ˆï¼Ÿä½ ä»¬å…¬å¸è¿˜æ²¡åƒä¸Š14ï¼Œå“¦ï¼Œæˆ‘ä»¬å…¬å¸ä¹Ÿæ²¡....ä½†æ˜¯ä½¿ç”¨vavrå¯ä»¥ä½“éªŒåˆ°scalaèˆ¬çš„æ¨¡å¼åŒ¹é…ã€‚Javaçš„switchåªèƒ½å¯¹å¸¸é‡èµ·ä½œç”¨ï¼Œè€Œä¸”é™åˆ¶éå¸¸å¤šï¼Œè™½ç„¶jdk7åŠ å…¥çš„stringï¼Œä½†æ˜¯å±…ç„¶åº•å±‚ç”¨equals()å»æ¯”è¾ƒï¼Œè¿™æ„å‘³ç€ä½ ä¼ å…¥ä¸€ä¸ªnullï¼Œç›´æ¥NPEæŠ›å‡ºæ¥è€Œä¸æ˜¯èµ°åˆ°defaultã€‚è€Œæ¨¡å¼åŒ¹é…ä¸ä»…ä»…å¯ä»¥è§„é¿ç§ç§é—®é¢˜ï¼Œè¿˜å¯ä»¥å¯¹å¦å¤–ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼èµ·ä½œç”¨ä»£ç å‡½æ•°ä¹Ÿèƒ½èŠ‚çœä¸å°‘ã€‚

- è¯­æ³•åŸºç¡€æ¼”ç¤ºï¼Œ

Match(é‡Œé¢æ”¾å…¥è¦åŒ¹é…çš„å˜é‡).ofåé¢å°±å¼€å§‹è¿›è¡ŒcaseåŒ¹é…ï¼Œå…¶ä¸­$()é‡Œé¢æ”¾å…¥åŒ¹é…é¢„æœŸå€¼ï¼Œåé¢æ”¾å…¥åŒ¹é…åéœ€è¦è¿”å›çš„å€¼ã€‚æ³¨æ„æ¨¡å¼åŒ¹é…è‡ªåŠ¨ä¼šbreakï¼Œå¦‚æœ$()å•¥ä¹Ÿä¸å†™å°±æ˜¯ç±»ä¼¼switchçš„default

```java
@Test
public void showTest() {
  int input = 2;
  String result = Match(input).of(
      Case($(1), "one"),
      Case($(2), "two"),
      Case($(3), "three"),
      Case($(), "?"));
  System.out.println(result);
}
// two
```

- è¯­æ³•é«˜çº§åŒ¹é…æ¼”ç¤º

$()å…¶å®è¿˜æœ‰ä¸€ä¸ªé‡è½½æ–¹æ³•ï¼Œæ˜¯ä¼ å…¥ä¸€ä¸ªpredicateå‡½æ•°ï¼Œvavræœ‰è‡ªå·±çš„predicateå‡½æ•°å¼æ¥å£ï¼Œé‡Œé¢æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œä¾‹å¦‚ä¸‹é¢ä»£ç å—çš„isIn()å°±æ˜¯predicateé‡Œé¢çš„æ–¹æ³•ï¼Œä»–çš„è¿”å›å€¼å°±æ˜¯ä¸€ä¸ªpredicateå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯å¯ä»¥åŒ¹é…å¤šä¸ªå€¼ã€‚

- ***$()***: ç±»ä¼¼äº switch è¯­å¥ä¸­çš„ *default* case çš„é€šé…ç¬¦æ¨¡å¼ã€‚å®ƒå¤„ç†æ‰¾ä¸åˆ°åŒ¹é…é¡¹çš„æƒ…å†µã€‚
- ***$(value)***: è¿™æ˜¯ç­‰å€¼æ¨¡å¼ï¼Œå…¶ä¸­ä¸€ä¸ªå€¼åªæ˜¯ç®€å•åœ°ä¸è¾“å…¥è¿›è¡Œæ¯”è¾ƒã€‚
- ***$(predicate)***: è¿™æ˜¯æ¡ä»¶æ¨¡å¼ï¼Œå…¶ä¸­predicateå‡½æ•°åº”ç”¨äºè¾“å…¥ï¼Œç»“æœå¸ƒå°”å€¼ç”¨äºåšå‡ºå†³å®šã€‚

```java
@Test
public void isInTest() {
  int input = 1;
  String result = Match(input).of(
      Case($(isIn(0, 1)), "zero or one"),
      Case($(2), "two"),
      Case($(3), "three"),
      Case($(), "?"));
  System.out.println(result);
}
// zero or one
```

```java
@Test
public void anyOfTest() {
  Integer year = 1990;
  String result = Match(year).of(
      Case($(anyOf(isIn(1990, 1991, 1992), is(1986))), "Age match"),
      Case($(), "No age match"));
  System.out.println(result);
}
// Age match
```

```java
@Test
public void customTest() {
  int i = 5;
  List<Integer> container = Lists.newArrayList(1, 2, 3, 4);

  String result = Match(i).of(
    // è¿™é‡Œå¯ä»¥æ¢æˆæ–¹æ³•å¼•ç”¨ï¼Œ ä¸ºäº†æ›´åŠ å¥½ç†è§£ï¼Œå°±ä½¿ç”¨lambdaå†™äº†
      Case($(e -> container.contains(e)), "Even Single Digit"),
      Case($(), "Out of range"));
  System.out.println(result);
}
// Out of range
```

- å‰¯ä½œç”¨å±•ç¤º

çœ‹åˆ°ä¸Šé¢çš„ä¾‹å­ï¼Œå…¶å®æ¯ä¸€ä¸ªcaseéƒ½è¿”å›äº†ä¸€ä¸ªå€¼ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬åŒ¹é…åˆ°ï¼Œä½†æ˜¯æ²¡æœ‰ä¸œè¥¿è¿”å›ï¼Œä»…ä»…é€šè¿‡å‰¯ä½œç”¨æ¥dosomethingã€‚ä¸‹é¢ä»£ç çœ‹èµ·æ¥æ¯”è¾ƒç»•ï¼Œæˆ‘ç¨ç¨è§£é‡Šä¸€ä¸‹ï¼Œå› ä¸ºCaseçš„ç¬¬äºŒä¸ªå‚æ•°æˆ‘ä»¬æœ€å¼€å§‹æ˜¯æ”¾è¿”å›å€¼ï¼Œç°åœ¨å¦‚æœè¦ä½¿ç”¨å‰¯ä½œç”¨å¿…é¡»æ”¾ä¸€ä¸ªSupplierï¼Œåˆ«é—®æˆ‘ä¸ºä»€ä¹ˆè¿™æ˜¯äººå®¶è¦æ±‚çš„ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨`() ->`ï¼Œé‚£è¿”å›ä»€ä¹ˆå‘¢ï¼Œè¿™é‡Œæ”¾å…¥run()çš„æ–¹æ³•ï¼Œrun()æ–¹æ³•çš„å…¥å‚æ˜¯ä¸€ä¸ªRunnableï¼Œå‡ºå‚æ˜¯ä¸€ä¸ªVoidï¼Œé‚£ä¹ˆè¿™ä¸ªVoidæ˜¯å¯ä»¥å¿½ç•¥æ‰ï¼Œæ³¨æ„è¿™ä¸ªVoidæ˜¯vavræä¾›çš„ï¼Œä¸æ˜¯jdkçš„å…³é”®å­—voidã€‚åªéœ€è¦æŠŠå‰¯ä½œç”¨çš„ä»£ç æ”¾å…¥æ„å»ºä¸€ä¸ªRunnableæ¥å£å°±å¯ä»¥å•¦ã€‚Runnableå°±æ˜¯langåŒ…ä¸‹çš„Runnableï¼Œè¿™ä¸ªä¸ç”¨æˆ‘å¤šè¯´å§ã€‚

```java
@Test
public void sideEffectsTest() {
  int i = 4;
  Match(i).of(
      Case($(isIn(2, 4, 6, 8)), () -> run(() -> System.out.println("è¿™æ˜¯ç¬¬ä¸€ç±»"))),
      Case($(isIn(1, 3, 5, 7, 9)), () -> run(() -> System.out.println("è¿™æ˜¯ç¬¬äºŒç±»"))),
      Case($(), o -> run(() -> System.out.println("æ²¡æœ‰æ‰¾åˆ°"))));
}
```



### Try

Tryç±»ä¼¼äºjdkçš„try catchã€‚åœ¨Tryä¸­æ‰§è¡Œçš„ä»£ç ä¸ä¼šæŠ›å¼‚å¸¸ï¼Œå¼‚å¸¸å’Œæ­£å¸¸è¿”å›å€¼éƒ½ä¼šè¢«vavræ¥ç®¡ï¼Œç„¶åé€šè¿‡Tryçš„åœ¨è¿›è¡Œè¿”å›ã€‚å…·ä½“ç”¨æ³•å°±æ˜¯Try.of()ã€‚ ç„¶åofé‡Œé¢ä¼ å…¥ä¸€ä¸ªsupplierï¼Œå…¥å‚å›ºå®šæ˜¯`() ->`ï¼Œè¿”å›å€¼å°±æ˜¯ä½ çš„å‡½æ•°äº§ç”Ÿçš„ç»“æœã€‚

- åŸºæœ¬æ¼”ç¤º

```java
@Test
public void tryTest() {
  Try<Integer> result = Try.of(() -> 1 / 0);
  // è¿”å›æ˜¯å¦å¤±è´¥
  System.out.println(result.isSuccess());
  // è¿”å›å¼‚å¸¸åŸå› , å¦‚æœæ²¡æœ‰å¼‚å¸¸è¿›è¡Œè·å–åˆ™ä¼šUOE
  System.out.println(result.getCause());
  // è·å–è¿”å›å€¼, å¦‚æœæœ‰å¼‚å¸¸åˆ™è¿”å›null
  System.out.println(result.getOrNull());
  // è·å–è¿”å›å€¼, å¦‚æœæœ‰å¼‚å¸¸åˆ™è¿”å›è®¾ç½®çš„é»˜è®¤å€¼
  System.out.println(result.getOrElse(0));
}
// false
// java.lang.ArithmeticException: / by zero
// null
// 0
```

é‡Œé¢å…¶å®è¿˜è‡ªå¸¦äº†å¾ˆå¤šæ–¹æ³•ï¼Œæœ‰ç‚¹ç±»ä¼¼jdkçš„optionalï¼Œä¹Ÿæ˜¯ç±»ä¼¼äºä¸€ä¸ª''å®¹å™¨''ï¼Œåªä¸è¿‡å®ƒå®¹çº³çš„æ˜¯å¯èƒ½å‡ºé”™çš„è¡Œä¸ºï¼Œå¯ä»¥è®©ä½ è¿›è¡Œæ¥ä¸‹çš„å¤„ç†æˆ–è€…å…œåº•æ–¹æ¡ˆã€‚ä¸€èˆ¬ç®€å•å¤„ç†æˆ‘ä¼šä½¿ç”¨Tryï¼Œå› ä¸ºçœŸçš„å¾ˆæ–¹ä¾¿ã€‚

ä¾‹å¦‚åŸæ¥åœ¨JSON.parseObject()çš„æ—¶å€™æˆ‘ä¸€èˆ¬éƒ½ä¼šç”¨try catchåŒ…ä¸€ä¸‹ï¼Œå¸Œæœ›èƒ½å¤Ÿå¥å£®ä¸€ç‚¹ï¼Œé¬¼çŸ¥é“ä¸Šæ¸¸ä¼ è¿‡æ¥çš„æ˜¯ä»€ä¹ˆä¸²ï¼Œä½†æ˜¯try catchå†™çš„æŒºéš¾çœ‹çš„ï¼Œå¦‚æœä½¿ç”¨TryåŒ…ä¸€ä¸‹å°±çœ‹èµ·æ¥èˆ’æœä¸€äº›ã€‚

```java
  @Test
  public void trySeniorTest() {
    List<Integer> list = Try.of(() -> JSON.parseArray("json", Integer.class))
        .getOrElse(Collections.emptyList());
    System.out.println(list);
  }
// []
```



## ä¸å¯å˜çš„é›†åˆç±»

### Tuple

ä¼—æ‰€å‘¨çŸ¥ï¼Œjavaæ˜¯æ²¡æœ‰å…ƒç¥–çš„ï¼Œä½†æ˜¯æœ‰æ—¶å€™å…ƒç¥–æ˜¯çœŸçš„å¥½ç”¨ï¼Œvavré€šè¿‡æ³›å‹å®ç°äº†å…ƒç¥–ï¼Œå¯ä»¥ä½¿ç”¨Tupleçš„é™æ€å·¥å‚åˆ›å»ºå…ƒç¥–ï¼Œå¹¶ä¸”ä½¿ç”¨ideaçš„è‡ªåŠ¨æ¨æ–­æˆ–è€…java10çš„varç±»å‹æ¨æ–­ç›´æ¥æ•ˆç‡é«˜åˆ°çˆ†æœ‰æ²¡æœ‰ã€‚ä½¿ç”¨æ–¹æ³•ä¹Ÿå’Œscalaå·®ä¸å¤šï¼Œ

>  å…ƒç¥–(Tuple)ç”±ä¸åŒå…ƒç´ ç»„æˆï¼Œæ¯ä¸ªå…ƒç´ å¯ä»¥å‚¨å­˜ä¸åŒç±»å‹çš„æ•°æ®ã€‚æœ‰ç‚¹åƒå¤šä¸ªæ³›å‹çš„Listï¼Œä¾‹å¦‚List<Integer>è¿™ä¸ªlistå°±åªèƒ½æ”¾Integerï¼Œ å…ƒç¥–æ˜¯Tuple<Integer, String>è¿™å°±è¡¨ç¤ºé‡Œé¢å¯ä»¥æ”¾Integerå’ŒStringï¼Œä½†æ˜¯å¾€å¾€æ˜¯éœ€è¦æŒ‡å®šæ•°é‡çš„ï¼Œå› ä¸ºéœ€è¦æŒ‡å®šé‚£ä¸ªä½ç½®çš„å…ƒç´ æ˜¯å“ªä¸ªç±»å‹ã€‚

- åŸºç¡€ä½¿ç”¨

é€šè¿‡Tuple.ofå¯ä»¥åˆå§‹åŒ–ï¼Œä½ åªéœ€è¦åœ¨ofé‡Œé¢æ”¾å…¥å…ƒç´ ï¼Œideaä¼šè‡ªåŠ¨å¸®ä½ æ¨æ–­å‡ºTupleå‡ ï¼Œç„¶åä½ ä½¿ç”¨å…ƒç´ åªéœ€è¦_å‡ å·å°±å¯ä»¥äº†ï¼Œä¾‹å¦‚1å·å…ƒç´ å°±æ˜¯`_1`

```java
@Test
public void tupleTest() {
  Tuple2<Integer, String> t2 = Tuple.of(1, "1");
  System.out.println(t2._1);
  System.out.println(t2._2);
}
```

- å…¶ä»–ä½¿ç”¨

Tupleæ˜¯ä¸å¯å˜çš„ï¼Œä½ å¯ä»¥å¯¹å®ƒè¿›è¡Œä¿®æ”¹æˆ–è€…æ·»åŠ ï¼Œä½†æ˜¯è¿›è¡Œæ›´æ”¹æ“ä½œå®ƒéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å…ƒç¥–ã€‚æ›´æ”¹å¾ˆç®€å•è°ƒç”¨`updateåŠ ä½ç½®()`æ–¹æ³•ï¼Œå¢åŠ ä¹Ÿå¾ˆç®€å•è°ƒç”¨`append()`æ–¹æ³•

```java
@Test
public void tupleSeniorTest() {
  Tuple2<Integer, String> t2 = Tuple.of(1, "1");
  System.out.println(t2);

  Tuple2<Integer, String> t2s = t2.update1(2);
  System.out.println(t2s);
  
  Tuple3<Integer, String, Double> t3 = t2.append(1.0);
  System.out.println(t3);
}
```

æˆ‘å¾ˆå–œæ¬¢å…ƒç¥–ï¼Œå› ä¸ºæœ‰æ—¶å€™æˆ‘å¾ˆæ‡’ï¼Œä¸æƒ³å¹²å•¥éƒ½åˆ›å»ºä¸€ä¸ªåˆ›å»ºpojoï¼Œæ›´ä¸æƒ³mapåˆ°å¤„ä¹±é£ï¼Œå…ƒç¥–ç”¨èµ·æ¥æ–¹ä¾¿ä¹Ÿå¾ˆæ¸…æ™°æ˜äº†ï¼Œæ˜¯ä¸¤è€…çš„æƒè¡¡ï¼Œå°¤å…¶æ˜¯é…åˆåŒ¹é…æ¨¡å¼ä½¿ç”¨ä¼˜é›…åº¦ç›´æ¥èµ·é£ã€‚ä½†æ˜¯ï¼ï¼ï¼è¯·æ³¨æ„ï¼Œvavrçš„Tupleä¸æ”¯æŒjacksonå’Œjsonçš„åºåˆ—åŒ–ï¼Œè¿™ä¸ªå‘æˆ‘å·²ç»æ›¿å¤§å®¶è¸©è¿‡äº†ï¼Œhttpè¿”å›å€¼æˆ–è€…æ˜¯rpcé€šä¿¡æ—¶è¯·ä¸è¦ä½¿ç”¨ã€‚



### List/Set/Map

å‡½æ•°å¼ç¼–ç¨‹å¾ˆé‡è¦ä¸€ä¸ªç‰¹æ€§å°±æ˜¯ä¸å˜æ€§ï¼Œjdkçš„Collectionså¯ä»¥è®©ä¸€ä¸ªé›†åˆç±»æˆä¸ºä¸å¯å˜ï¼Œä½†æ˜¯....show code

```java
@Test
public void collectionsTest() {
  List<Integer> list = Lists.newArrayList(1, 2, 3);
  System.out.println(list);
  List<Integer> unmodifiableList = Collections.unmodifiableList(list);
  System.out.println(unmodifiableList);

  list.add(1);
  System.out.println(list);
  System.out.println(unmodifiableList);

  unmodifiableList.add(1);
}
// [1, 2, 3]
// [1, 2, 3]
// [1, 2, 3, 1]
// [1, 2, 3, 1]
// 
// java.lang.UnsupportedOperationException
```

ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼ŒCollectionsä¸å¯å˜çš„listæ˜¯åŸæ¥listçš„ä¸€ä¸ªæµ…æ‹·è´ï¼ŒåŸæ¥çš„listè¿›è¡Œå…ƒç´ çš„æ›´æ”¹ä¾ç„¶ä¼šæ”¹åŠ¨è¿™ä¸ªæ‰€è°“çš„'ä¸å¯å˜'listã€‚

- vavrçš„list

vavrçš„listä½¿ç”¨`List.of()`æ¥åˆ›å»ºï¼Œåˆ›å»ºåä¸å¯å˜ï¼Œä½†æ˜¯å¯ä»¥å¢åŠ æˆ–è€…åˆ é™¤å…ƒç´ ï¼Œèªæ˜çš„ä½ è‚¯å®šçŸ¥é“äº†ï¼Œæ¯æ¬¡æ”¹åŠ¨ä»¥åéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ä¸å¯å˜listã€‚

```java
@Test
public void collectionsTest() {
  io.vavr.collection.List<Integer> list = io.vavr.collection.List.of(1, 2);
  // å¢åŠ ä¸€ä¸ªå…ƒç´ 
  io.vavr.collection.List<Integer> appendList = list.append(3);
  // ä¸¢æ‰ä¸€ä¸ªå…ƒç´ 
  io.vavr.collection.List<Integer> dropList = list.drop(1);
  
  // å˜æˆjavaçš„å¯å˜list
  List<Integer> javaList = list.asJava();
  
}
```

å¦å¤–vavrçš„listå¯ä»¥ç›´æ¥ä½¿ç”¨streamç®—å­ï¼Œä¸è®¸ç”¨åœ¨é€šè¿‡stream()è½¬æ¢æˆStreamæµï¼Œç„¶åå†ä½¿ç”¨ç®—å­ï¼Œä¸èƒ½è¯´å’Œscalaä¸€æ¨¡ä¸€æ ·ï¼Œåªèƒ½è¯´æ¯«æ— åŒºåˆ«ã€‚ç±»ä¼¼çš„ä¹Ÿæä¾›æä¾›äº†æ›´å¤š Functional çš„ APIï¼Œæ¯”å¦‚

- take(Integer) å–å‰ n ä¸ªå€¼
- tail() å–é™¤äº†å¤´ç»“ç‚¹å¤–çš„é›†åˆ
- zipWithIndex() ä½¿å¾—ä¾¿åˆ©æ—¶å¯ä»¥æ‹¿åˆ°ç´¢å¼•ï¼ˆä¸ç”¨ fori)
- find(Predicate) åŸºäºæ¡ä»¶æŸ¥è¯¢å€¼ï¼Œåœ¨ Java æ ‡å‡†åº“å¾—ä½¿ç”¨ filter + findFirst æ‰èƒ½å®ç°
  .....

## å…¶ä»–å‡½æ•°å¼ç¼–ç¨‹ç‰¹æ€§

### Option

ä¸è£…äº†ï¼Œæˆ‘æ‘Šç‰Œï¼Œè¿™ä¸ªoptionå’Œjdkçš„optionalæ˜¯ä¸€æ ·çš„ï¼Œåº”è¯¥çµæ„Ÿéƒ½æ˜¯æ¥è‡ªäºguavaçš„Optionalã€‚ä¸è¿‡vavrçš„Otionæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæœ‰ä¸¤ä¸ªå®ç°ç±»ï¼Œåˆ†åˆ«æ˜¯Someå’ŒNoneã€‚å‰è€…æœ‰å€¼çš„çŠ¶æ€ï¼Œåè€…æ— å€¼çš„çŠ¶æ€ã€‚é£Ÿç”¨æ–¹æ³•æ˜¯`Option.of()`

```java
@Test
public void multiFunctionTest() {
  Integer num = null;
  Option<Integer> opt = Option.of(num);

  // è¿™ä¸ªå’Œoptionalä¸€æ ·
  Integer result = opt.getOrElse(0);
  System.out.println(result);

  // å¦‚æœæ˜¯Noneåˆ™ä¼šè¿”å›ture
  boolean isEmpty = opt.isEmpty();
  System.out.println(isEmpty);

  // å˜æˆjavaçš„optional
  Optional<Integer> optional = opt.toJavaOptional();
}
// 0
// true
```

å› ä¸ºå¾ˆå¤šæ–¹æ³•æ‰€ä»¥éƒ½æ²¡æ”¾ï¼Œå¤§éƒ¨åˆ†æ–¹æ³•éƒ½æ˜¯å’Œoptionalä¸€æ ·çš„ï¼Œè¿˜æœ‰ä¸€äº›æ˜¯vavré€šç”¨çš„ï¼Œå¹¶ä¸æ˜¯optionç‹¬æœ‰ã€‚

### Lazy

å»¶è¿Ÿè®¡ç®—ä¹Ÿæ˜¯å‡½æ•°å¼ç¼–ç¨‹é‡Œé¢ä¸€ä¸ªç‰¹æ€§ï¼Œå°¤å…¶æ˜¯åœ¨scalaä¸­ç”¨çš„å¾ˆå¤šï¼Œå¹¶ä¸”ç¬¬ä¸€æ¬¡è®¡ç®—åä¼šæŠŠå€¼è¿›è¡Œç¼“å­˜ã€‚å¯¹èŠ‚çœå†…å­˜å’Œæå‡æ€§èƒ½éƒ½æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚

scalaä¸­æ˜¯é€šè¿‡å…³é”®å­—æ¥åšçš„ï¼Œä½†æ˜¯vavråœ¨javaä¸­æ€ä¹ˆåšåˆ°å‘¢ã€‚ç±»ä¼¼äºoptionä¸€æ ·çš„æŠŠå˜é‡è£…è½½ä¸€ä¸ªâ€˜â€™å®¹å™¨â€˜â€™ä¸­ï¼Œå–å€¼åŠ è½½ã€‚

```java
@Test
public void lazyTest() {
  // ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ç»™åˆ°lazyå®¹å™¨
  Lazy<Double> lazy = Lazy.of(Math::random);

  // åˆ¤æ–­æ˜¯å¦å·²ç»è·å–è¿‡äº†
  System.out.println(lazy.isEvaluated());

  // æ­£å¼è·å–lazyçš„å€¼
  System.out.println(lazy.get());

  // çœ‹çœ‹ç°åœ¨æ˜¯å¦è®¡ç®—äº†
  System.out.println(lazy.isEvaluated());

  // å†æ¬¡è·å–lazyçš„å€¼
  System.out.println(lazy.get());
}
// false
// 0.896267693320266
// true
// 0.896267693320266
```



## åè¨€

é‡Œé¢è¿˜æœ‰ä¸€äº›ç‰¹æ€§å¹¶æ²¡æœ‰ä»‹ç»åˆ°ï¼Œä¾‹å¦‚Eitherï¼ŒFutureï¼ŒPromiseï¼ŒValidationç­‰ï¼Œä¸€æ–¹é¢æ˜¯æˆ‘reviewè¿™ç¯‡æ–‡ç« åå‘ç°å†™çš„å¤ªé•¿äº†ï¼Œå¦å¤–ä¸€æ–¹é¢æ˜¯é¡¹ç›®ä¸­ç”¨åˆ°çš„åœºæ™¯æ¯”è¾ƒå°‘ï¼Œå¦‚æœå¤§å®¶æ„Ÿå…´è¶£å¯ä»¥å†™ä¸€ä¸ªvavrçš„é«˜çº§ç¯‡ä»‹ç»ä¸€ä¸‹ï¼Œå› ä¸ºæˆ‘è§‰å¾—è¿™é‡Œé¢æ¯ä¸€ä¸ªç‰¹æ€§éƒ½å€¼å¾—ä¸€ç¯‡æ–‡ç« æ¥è¯´ã€‚**å†™çš„æ—¶å€™æ˜¯ä¸‹åˆï¼Œè¶Šå†™åˆ°åé¢å‘ç°åˆ°å¤§åŠå¤œäº†ï¼Œåé¢ä¸€äº›ç‰¹æ€§ä»‹ç»å…¶å®éƒ½å¼€å§‹å·æ‡’ä¸è‡ªå·±æœ¬æ¥è®¡åˆ’åˆ†äº«çš„å°‘äº†å¥½å¤šğŸ˜‚ï¼Œç•™å‘ä¸‹æ¬¡è¡¥ã€‚**

å½“ç„¶å¦‚æœæ˜¯çœŸçš„æ„Ÿå…´è¶£ï¼Œæ¨èå¤§å®¶çœ‹ä¸€ä¸‹[resilience4j](https://github.com/resilience4j/resilience4j)ï¼Œè¿™æ˜¯ç”¨vavrå†™çš„é™æµç†”æ–­é™çº§ä¸­é—´ä»¶ï¼Œç”¨æ¥ä»£æ›¿Hystrixã€‚ä»£ç è´¨é‡çœŸçš„æ˜¯éå¸¸é«˜ï¼Œç”¨å®ƒæ¥å­¦ä¹ å‡½æ•°å¼ç¼–ç¨‹æˆ‘è®¤ä¸ºæ˜¯ç›®å‰æœ€å¥½çš„ææ–™ï¼Œå”¯ç‹¬å°±æ˜¯æ¯”è¾ƒéš¾å•ƒï¼Œå› ä¸ºå‡½æ•°ç¼–ç¨‹æœ¬èº«å°±æ˜¯å†™èµ·æ¥å¾ˆçˆ½ä½†æ˜¯å¯¹viewerä¸æ˜¯å¾ˆå‹å¥½ã€‚



## å‚è€ƒ

1. [Vavr User Guide](https://docs.vavr.io/#_stream)
2. [vavrå®˜æ–¹åšå®¢](http://blog.vavr.io/)
2. [vavrå®˜ç½‘](https://www.vavr.io/)
